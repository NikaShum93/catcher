<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–†–µ–¥–∞–∫—Ç–æ—Ä ‚Äî Catcher Pro</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&family=Rubik:wght@400;700&display=swap" rel="stylesheet">
  <link id="gf" rel="stylesheet" href=""> <style>
    :root {
      /* –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ */
      --bg-app: #0f172a;       /* –ì–ª—É–±–æ–∫–∏–π —Å–∏–Ω–∏–π —Ñ–æ–Ω */
      --bg-panel: #1e293b;     /* –ü–∞–Ω–µ–ª–∏ */
      --bg-input: #020617;     /* –ò–Ω–ø—É—Ç—ã */
      
      --accent: #f59e0b;       /* –û—Å–Ω–æ–≤–Ω–æ–π –∞–∫—Ü–µ–Ω—Ç (Amber) */
      --accent-glow: rgba(245, 158, 11, 0.4);
      --primary: #3b82f6;      /* –í—Ç–æ—Ä–∏—á–Ω—ã–π (Blue) */
      
      --text-main: #f8fafc;
      --text-muted: #94a3b8;
      
      --border: #334155;
      --radius: 12px;
      --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
    }

    * { box-sizing: border-box; }
    
    body {
      margin: 0;
      background-color: var(--bg-app);
      background-image: 
        radial-gradient(at 0% 0%, rgba(59, 130, 246, 0.15) 0px, transparent 50%),
        radial-gradient(at 100% 100%, rgba(245, 158, 11, 0.1) 0px, transparent 50%);
      background-attachment: fixed;
      color: var(--text-main);
      font-family: 'Inter', system-ui, sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden; /* –°–∫—Ä–æ–ª–ª–∏–º —Ç–æ–ª—å–∫–æ main */
    }

    /* === HEADER === */
    header {
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 14px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 10;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
    }
    .brand img { height: 32px; }
    .brand h1 {
      font-size: 18px;
      font-weight: 700;
      background: linear-gradient(90deg, #fff, var(--text-muted));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 0;
    }

    /* === LAYOUT === */
    main {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(350px, 450px) 1fr;
      gap: 0; /* –£–±–∏—Ä–∞–µ–º gap, –∏—Å–ø–æ–ª—å–∑—É–µ–º padding –≤–Ω—É—Ç—Ä–∏ —Å–∫—Ä–æ–ª–ª-–∑–æ–Ω */
      overflow: hidden;
      max-width: 1600px;
      width: 100%;
      margin: 0 auto;
    }

    /* –°–∫—Ä–æ–ª–ª—è—â–∞—è—Å—è –ª–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ (–ù–∞—Å—Ç—Ä–æ–π–∫–∏) */
    .scroll-col {
      overflow-y: auto;
      padding: 24px;
      padding-bottom: 100px;
      scrollbar-width: thin;
      scrollbar-color: var(--border) transparent;
      border-right: 1px solid var(--border);
    }

    /* –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ (–ü—Ä–µ–≤—å—é + –£—Ä–æ–≤–Ω–∏) */
    .sticky-col {
      overflow-y: auto;
      padding: 24px;
      background: rgba(15, 23, 42, 0.3);
    }

    /* === CARDS & SECTIONS === */
    .section-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin: 24px 0 12px;
      font-weight: 700;
    }
    .section-title:first-child { margin-top: 0; }

    .card {
      background: var(--bg-panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: var(--shadow);
      transition: border-color 0.2s;
    }
    .card:hover { border-color: #475569; }

    .card h2 {
      margin: 0 0 16px;
      font-size: 16px;
      color: var(--accent);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* === FORMS === */
    label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 6px;
    }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
    
    input[type="text"], input[type="number"], input[type="url"], textarea, select {
      width: 100%;
      background: var(--bg-input);
      border: 1px solid var(--border);
      color: #fff;
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s;
    }
    textarea { resize: vertical; min-height: 80px; line-height: 1.4; }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }

    /* Custom Checkbox */
    .checkbox-wrap {
      display: flex;
      align-items: center;
      gap: 10px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
    }
    .checkbox-wrap input { margin: 0; }
    .checkbox-wrap label { margin: 0; color: #fff; cursor: pointer; }

    /* Color Picker Override */
    input[type="color"] {
      padding: 0; border: none; width: 100%; height: 40px; 
      background: none; cursor: pointer; border-radius: 8px;
    }

    /* === BUTTONS === */
    button {
      background: linear-gradient(135deg, var(--accent), #d97706);
      color: #000;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
      transition: transform 0.1s, box-shadow 0.2s;
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    }
    button:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(245, 158, 11, 0.4); }
    button:active { transform: translateY(0); }

    .btn-ghost {
      background: rgba(255,255,255,0.05);
      color: var(--text-main);
      box-shadow: none;
      border: 1px solid var(--border);
    }
    .btn-ghost:hover { background: rgba(255,255,255,0.1); }
    
    .btn-danger { background: #ef4444; color: white; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3); }

    /* === PREVIEW AREA (Sticky) === */
    .preview-sticky-wrap {
      position: sticky;
      top: 0;
      z-index: 5;
    }
    .preview-stage {
      background: #000;
      border: 1px dashed var(--border);
      border-radius: var(--radius);
      height: 280px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      margin-top: 10px;
    }
    /* –°—Ç–∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–µ–≤—å—é */
    .preview-item {
      position: relative;
      display: inline-flex; align-items: center; justify-content: center;
      padding: 18px 22px; 
      transition: all 0.2s ease;
      background-size: cover !important; 
      background-position: center !important;
    }
    .preview-item img { width: 100%; height: 100%; object-fit: contain; }
    
    /* Shapes & FX */
    .shape-rect{border-radius:10px}
    .shape-rounded{border-radius:20px}
    .shape-circle{border-radius:50%}
    .shape-diamond{clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);}
    .shape-star{clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)}
    .fx-shadow{box-shadow:0 10px 30px rgba(0,0,0,.5)}
    .fx-glow{box-shadow:0 0 18px var(--glow)}
    .fx-3d{box-shadow:7px 7px 20px rgba(0,0,0,.5), inset -5px -5px 12px rgba(255,255,255,.22)}
    .fx-border{border-style:solid}

    /* === LEVELS === */
    .level {
      background: rgba(30, 41, 59, 0.5);
      border: 1px solid var(--border);
      border-left: 4px solid var(--primary);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .level-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 12px;
    }
    .level-header h3 { margin: 0; font-size: 14px; color: var(--text-main); }
    .level-actions { display: flex; gap: 4px; }
    .level-actions button {
      padding: 6px 10px; font-size: 12px; border-radius: 4px;
    }

    /* === PUBLISH AREA === */
    .publish-area {
      background: linear-gradient(180deg, var(--bg-panel), #0f172a);
      border: 1px solid var(--accent-glow);
      box-shadow: 0 0 20px rgba(245, 158, 11, 0.05);
    }
    #iframeOut {
      font-family: 'Menlo', monospace;
      font-size: 12px;
      color: var(--accent);
      background: #000;
      border: 1px solid var(--border);
    }
    
    /* Footer */
    footer {
      text-align: center; padding: 20px; color: var(--text-muted); font-size: 12px;
      border-top: 1px solid var(--border);
      background: var(--bg-app);
    }
    footer a { color: var(--primary); text-decoration: none; }

    /* Hint text */
    .hint { font-size: 11px; color: var(--text-muted); margin-top: 4px; line-height: 1.4; }

  </style>
</head>
<body>

  <header>
    <a href="#" class="brand">
      <img src="https://con.xl.ru/fnfLZuvpAUiDaqDs8d1-2g/images/kcJYv7OsYUSGt5AfGq5jIw.png" alt="Logo">
      <h1>Catcher <span style="color:var(--accent)">Editor</span></h1>
    </a>
    <div>
       <button id="saveBtnTop" class="btn-ghost">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </header>

  <main>
    <div class="scroll-col">
      
      <div class="section-title">–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</div>
      
      <div class="card">
        <h2>üé® –°—Ç–∏–ª—å –∏–≥—Ä—ã</h2>
        <div class="row">
          <div>
            <label>–Ø–∑—ã–∫</label>
            <select id="language"></select>
          </div>
          <div>
            <label>–®—Ä–∏—Ñ—Ç</label>
            <select id="font"></select>
          </div>
        </div>
        
        <div class="row">
          <div>
            <label>–§–æ–Ω (—Ü–≤–µ—Ç)</label>
            <input type="color" id="bgColor" value="#0f172a">
          </div>
          <div>
            <label>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç–æ–≤</label>
            <input type="number" id="opacity" value="1" step="0.1" min="0" max="1">
          </div>
        </div>
        
        <label>–§–æ–Ω–æ–≤–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ (URL)</label>
        <textarea id="bgImages" style="min-height:60px" placeholder="https://..."></textarea>
      </div>

      <div class="card">
        <h2>üîÆ –î–∏–∑–∞–π–Ω —ç–ª–µ–º–µ–Ω—Ç–æ–≤</h2>
        <div class="row">
          <div>
             <label>–§–æ—Ä–º–∞</label>
             <select id="shape">
               <option value="rect">–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫</option>
               <option value="rounded" selected>–°–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–π</option>
               <option value="circle">–ö—Ä—É–≥</option>
               <option value="diamond">–†–æ–º–±</option>
               <option value="star">–ó–≤–µ–∑–¥–∞</option>
             </select>
          </div>
          <div>
             <label>–†–∞–∑–º–µ—Ä (px)</label>
             <input type="number" id="imgBox" value="160">
          </div>
        </div>

        <div class="row">
           <div class="checkbox-wrap">
             <input type="checkbox" id="shadowOn" checked>
             <label for="shadowOn">–¢–µ–Ω—å</label>
           </div>
           <div class="checkbox-wrap">
             <input type="checkbox" id="fx3d">
             <label for="fx3d">3D –û–±—ä–µ–º</label>
           </div>
        </div>
        
        <div class="row" style="align-items: center;">
           <div class="checkbox-wrap">
             <input type="checkbox" id="glowOn">
             <label for="glowOn">–ù–µ–æ–Ω</label>
           </div>
           <input type="color" id="glowColor" value="#00f0ff" style="height:38px">
        </div>

        <div class="row" style="align-items: center;">
           <div class="checkbox-wrap">
             <input type="checkbox" id="borderOn" checked>
             <label for="borderOn">–†–∞–º–∫–∞</label>
           </div>
           <input type="number" id="borderWidth" value="2" style="width:60px">
           <input type="color" id="borderColor" value="#ffffff" style="height:38px">
        </div>
        
        <div class="row">
           <div>
             <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
             <input type="color" id="textColor" value="#ffffff">
           </div>
           <div>
             <label>–†–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞</label>
             <input type="number" id="fontSize" value="24">
           </div>
        </div>
      </div>

      <div class="section-title">–ì–µ–π–º–ø–ª–µ–π</div>

      <div class="card" style="border-color: var(--accent);">
        <h2>ü¶∏‚Äç‚ôÇÔ∏è –ü–µ—Ä—Å–æ–Ω–∞–∂ (–õ–æ–≤–µ—Ü)</h2>
        <label>–ö–∞—Ä—Ç–∏–Ω–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (URL)</label>
        <input type="url" id="playerImg" placeholder="https://.../hero.png">
        <div class="hint">–û—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –∏–≥—Ä–∞—Ç—å –∫–ª–∏–∫–∞–º–∏ (–±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞).</div>
        
        <div class="row" style="margin-top:12px">
          <div>
            <label>–®–∏—Ä–∏–Ω–∞ (px)</label>
            <input type="number" id="playerWidth" value="120">
          </div>
          <div>
            <label>–í—ã—Å–æ—Ç–∞ (px)</label>
            <input type="number" id="playerHeight" value="120">
          </div>
        </div>
      </div>

      <div class="card">
        <h2>‚öôÔ∏è –ú–µ—Ö–∞–Ω–∏–∫–∞</h2>
        <div class="row">
          <div>
            <label>–°–∫–æ—Ä–æ—Å—Ç—å (1-10)</label>
            <input type="number" id="speed" value="5" min="1" max="10">
          </div>
          <div>
            <label>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label>
            <select id="direction">
              <option value="down">–ü–∞–¥–∞—é—Ç –≤–Ω–∏–∑</option>
              <option value="up">–õ–µ—Ç—è—Ç –≤–≤–µ—Ä—Ö</option>
            </select>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>üìù –¢–µ–∫—Å—Ç—ã</h2>
        <div class="row">
          <div>
            <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ä—Ç–∞</label>
            <input type="text" id="startTitle" placeholder="Catch them all!">
          </div>
          <div>
            <label>–ö–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ä—Ç–∞</label>
            <input type="text" id="startBtnText" placeholder="Start Game">
          </div>
        </div>
        <label>–§–∏–¥–±–µ–∫ –≤ –∫–æ–Ω—Ü–µ</label>
        <textarea id="finalFeedback" placeholder="Great Job!"></textarea>
      </div>

    </div> <div class="sticky-col">
      
      <div class="card preview-sticky-wrap">
        <h2 style="font-size:14px; color:var(--text-muted); text-transform:uppercase">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —ç–ª–µ–º–µ–Ω—Ç–∞</h2>
        
        <div class="row" style="margin-bottom:0">
           <input type="text" id="previewValue" value="Word">
           <div style="display:flex; gap:4px">
             <button class="btn-ghost" id="btnText" style="flex:1">–¢</button>
             <button class="btn-ghost" id="btnImage" style="flex:1">IMG</button>
           </div>
        </div>

        <div class="preview-stage">
          <div id="previewItem" class="preview-item shape-rounded fx-shadow" style="--glow:#00f0ff;">
            <span id="previewText" style="font-weight:800; font-size:24px">Word</span>
          </div>
        </div>
      </div>

      <div class="section-title">–ö–æ–Ω—Ç–µ–Ω—Ç –∏–≥—Ä—ã</div>
      
      <div id="levels"></div>
      
      <button id="addLevel" class="btn-ghost" style="width:100%; border-style:dashed; margin-bottom: 24px;">
        ‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å
      </button>

      <div class="card publish-area">
        <h2>üöÄ –ü—É–±–ª–∏–∫–∞—Ü–∏—è</h2>
        <button id="saveBtn" style="width:100%; margin-bottom:12px">üíæ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∏–≥—Ä—É</button>
        <button id="testBtn" class="btn-ghost" style="width:100%; margin-bottom:12px; font-size:12px">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å JSON</button>
        
        <label>–ö–æ–¥ –¥–ª—è Genially (Iframe)</label>
        <textarea id="iframeOut" readonly onclick="this.select()" placeholder="–ù–∞–∂–º–∏ '–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å', —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∫–æ–¥..."></textarea>
        <button id="copyBtn" class="btn-ghost" style="width:100%; margin-top:8px">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
      </div>

    </div>
  </main>

  <script>
    /* =========================================
       LOGIC (–¢–æ—Ç –∂–µ –∫–æ–¥, —á—Ç–æ –∏ —Ä–∞–Ω—å—à–µ, –Ω–æ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–æ–≤–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞)
       ========================================= */
    const $ = sel => document.querySelector(sel);
    const $$ = sel => document.querySelectorAll(sel);

    const FONT_MAP = {
      ru: ["Rubik","PT Sans","Montserrat","Open Sans","Comfortaa","Russo One"],
      en: ["Rubik","Roboto","Montserrat","Poppins","Bangers","Fredoka One"],
      math: ["Latin Modern Math","Rubik"]
    };

    // --- Init ---
    function init(){
      fillLanguageSelect();
      fillFontsForLanguage('ru');
      addLevel();
      applyGoogleFont('Rubik');
      updatePreview();
      
      // Events
      $('#language').onchange = e => { fillFontsForLanguage(e.target.value); updatePreview(); };
      $('#font').onchange = e => { applyGoogleFont(e.target.value); updatePreview(); };
      
      // Inputs monitoring
      const inputs = ['textColor','opacity','shape','bgColor','bgImages','borderColor','borderWidth',
                      'borderOn','shadowOn','glowOn','glowColor','fx3d','previewValue','speed','pad',
                      'direction','startTitle','startBtnText','imgBox','playerImg'];
      inputs.forEach(id => {
        const el = $('#'+id);
        if(el) { el.oninput = updatePreview; el.onchange = updatePreview; }
      });

      $('#btnText').onclick = () => { $('#previewItem').dataset.mode='text'; updatePreview(); };
      $('#btnImage').onclick = () => { $('#previewItem').dataset.mode='image'; updatePreview(); };
      
      $('#addLevel').onclick = addLevel;
      $('#saveBtn').onclick = publish;
      $('#saveBtnTop').onclick = publish; // –í–µ—Ä—Ö–Ω—è—è –∫–Ω–æ–ø–∫–∞
      $('#testBtn').onclick = quickTest;
      $('#copyBtn').onclick = copyIframe;
    }

    // --- Functions ---
    function fillLanguageSelect(){
      const sel = $('#language');
      sel.innerHTML = '<option value="ru">–†—É—Å—Å–∫–∏–π</option><option value="en">English</option><option value="math">Math</option>';
    }

    function fillFontsForLanguage(lang){
      const sel = $('#font');
      const list = FONT_MAP[lang] || FONT_MAP.en;
      sel.innerHTML = list.map(f => `<option>${f}</option>`).join('');
      sel.value = list[0];
    }

    function applyGoogleFont(fontName){
      $('#gf').href = `https://fonts.googleapis.com/css2?family=${fontName.replace(/ /g,'+')}:wght@400;700&display=swap`;
      const txt = $('#previewText');
      txt.style.fontFamily = `"${fontName}", system-ui`;
      txt.style.fontSize = ($('#fontSize').value || 24) + 'px';
    }

    function updatePreview(){
      const item = $('#previewItem');
      const text = $('#previewText');
      const val  = $('#previewValue').value;
      const isImg = item.dataset.mode === 'image';

      // Styles
      item.className = `preview-item shape-${$('#shape').value}`;
      if($('#shadowOn').checked) item.classList.add('fx-shadow');
      if($('#fx3d').checked) item.classList.add('fx-3d');
      if($('#glowOn').checked) {
        item.classList.add('fx-glow');
        item.style.setProperty('--glow', $('#glowColor').value);
      } else {
        item.classList.remove('fx-glow');
      }

      // Border
      if($('#borderOn').checked && $('#borderWidth').value > 0){
        item.style.border = `${$('#borderWidth').value}px solid ${$('#borderColor').value}`;
      } else {
        item.style.border = 'none';
      }

      // Bg
      const bgList = ($('#bgImages').value||'').split('\n').filter(s=>s.trim().startsWith('http'));
      if(bgList.length){
        item.style.background = `url(${bgList[0]}) center/contain no-repeat`;
        item.style.backgroundColor = 'transparent';
      } else {
        item.style.background = 'none';
        item.style.backgroundColor = $('#bgColor').value;
      }
      
      item.style.opacity = $('#opacity').value;

      // Content
      if(isImg || val.startsWith('http')){
        item.innerHTML = `<img src="${val.startsWith('http') ? val : 'https://via.placeholder.com/150/FFFFFF/000000?text=IMG'}" style="width:100%;height:100%;object-fit:contain">`;
        const sz = $('#imgBox').value || 160;
        item.style.width = sz+'px'; item.style.height = sz+'px';
      } else {
        item.innerHTML = `<span id="previewText">${val}</span>`;
        const t = item.querySelector('span');
        t.style.color = $('#textColor').value;
        t.style.fontSize = $('#fontSize').value + 'px';
        t.style.fontFamily = `"${$('#font').value}", system-ui`;
        item.style.width = 'auto'; item.style.height = 'auto';
        item.style.minWidth = '120px'; item.style.minHeight = '80px';
      }
    }

    function levelTemplate(i){
      const div = document.createElement('div');
      div.className = 'level';
      div.innerHTML = `
        <div class="level-header">
           <h3>LEVEL ${i+1}</h3>
           <div class="level-actions">
             <button class="btn-ghost up">‚ñ≤</button>
             <button class="btn-ghost down">‚ñº</button>
             <button class="btn-danger del">√ó</button>
           </div>
        </div>
        <input type="text" class="target" placeholder="Target (e.g. Animals)" style="margin-bottom:8px">
        <div class="row">
           <textarea class="correct" placeholder="Correct items..."></textarea>
           <textarea class="wrong" placeholder="Wrong items..."></textarea>
        </div>
        <div class="row" style="margin-bottom:0">
           <div><label>Timer</label><input type="number" class="timer" value="30"></div>
        </div>
      `;
      div.querySelector('.del').onclick = () => { div.remove(); renumber(); };
      div.querySelector('.up').onclick = () => { if(div.previousSibling) div.parentNode.insertBefore(div, div.previousSibling); renumber(); };
      div.querySelector('.down').onclick = () => { if(div.nextSibling) div.parentNode.insertBefore(div.nextSibling, div); renumber(); };
      return div;
    }

    function addLevel(){ $('#levels').appendChild(levelTemplate($$('#levels .level').length)); }
    function renumber(){ $$('#levels .level h3').forEach((h,i) => h.textContent = `LEVEL ${i+1}`); }

    // --- DATA ---
    function collectConfig(){
      const levels = [];
      $$('.level').forEach(l => {
        levels.push({
          target: l.querySelector('.target').value.trim(),
          correct: l.querySelector('.correct').value.split('\n').filter(s=>s.trim()),
          wrong: l.querySelector('.wrong').value.split('\n').filter(s=>s.trim()),
          timer: l.querySelector('.timer').value
        });
      });
      
      const bgImages = ($('#bgImages').value||'').split('\n').filter(s=>s.trim());

      return {
        language: $('#language').value,
        font: $('#font').value,
        fontSize: $('#fontSize').value,
        textColor: $('#textColor').value,
        speed: $('#speed').value,
        style: {
          shape: $('#shape').value,
          bgColor: $('#bgColor').value,
          bgImages: bgImages,
          borderOn: $('#borderOn').checked,
          borderColor: $('#borderColor').value,
          borderWidth: $('#borderWidth').value,
          shadow: $('#shadowOn').checked,
          glow: $('#glowOn').checked,
          glowColor: $('#glowColor').value,
          fx3d: $('#fx3d').checked,
          opacity: $('#opacity').value,
          imgBox: $('#imgBox').value
        },
        player: {
          img: $('#playerImg').value.trim(),
          width: $('#playerWidth').value,
          height: $('#playerHeight').value
        },
        direction: $('#direction').value,
        start: { title: $('#startTitle').value, btnText: $('#startBtnText').value },
        finalFeedback: $('#finalFeedback').value,
        levels: levels
      };
    }

    // --- PUBLISH ---
    const ENDPOINT = "https://server-kjnn.onrender.com/publish";
    const KEY = "nika_read_pub_2025";
    const BASE = "https://nikashum93.github.io/catcher/main.html";

    async function publish(){
      const cfg = collectConfig();
      if(!cfg.levels.length || !cfg.levels[0].target) return alert("Add at least 1 level with a target!");
      
      const btn = $('#saveBtn');
      const oldTxt = btn.textContent;
      btn.textContent = "‚è≥ Publishing...";
      btn.disabled = true;

      const id = (cfg.levels[0].target.replace(/[^a-z0-9]/gi,'-') + '-' + Date.now()).toLowerCase();
      
      try {
        const res = await fetch(ENDPOINT, {
           method:'POST',
           headers: {'Content-Type':'application/json', 'X-Publish-Key': KEY},
           body: JSON.stringify({ id, mode:'json', folder:'data', content: JSON.stringify(cfg) })
        });
        if(!res.ok) throw new Error();
        
        const code = `<iframe src="${BASE}?id=${id}" width="900" height="600" style="border:0" allow="autoplay; fullscreen"></iframe>`;
        $('#iframeOut').value = code;
        alert("‚úÖ Ready! Copy the code below.");
      } catch(e) {
        alert("‚ùå Error publishing.");
      }
      btn.textContent = oldTxt;
      btn.disabled = false;
    }

    function quickTest() { console.log(collectConfig()); alert("Check console for JSON"); }
    function copyIframe() { $('#iframeOut').select(); document.execCommand('copy'); }

    // Start
    init();

  </script>
</body>
</html>
